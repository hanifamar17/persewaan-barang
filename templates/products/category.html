{% extends "base/base.html" %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<section class="w-full xl:w-2/5 max-h-[300px] p-8 bg-white rounded shadow text-gray-800">
  <!-- Header -->
  <div class="text-center md:text-left space-y-2 mb-8">
    <h1 class="text-xl font-medium text-gray-800">Tambah Kategori Produk</h1>
    <p class="text-gray-500 text-sm">Masukkan informasi kategori untuk produk yang disewakan</p>
  </div>

  <div class="">
    <form id="addCategoryForm" method="POST" class="space-y-6">
      <!-- Grid for 2 Columns -->
      <div class="grid gap-6 md:grid-cols-2">
        <!-- Name -->
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-900">Name*</label>
          <input type="text" name="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg 
             focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" placeholder="contoh: pakaian" required>
        </div>

        <!-- Description -->
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-900">Description</label>
          <textarea name="description" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg 
             focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"></textarea>
        </div>
      </div>

      <!-- Submit -->
      <div class="flex justify-end">
        <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
             rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
             focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          Add Category
        </button>
      </div>
    </form>

  </div>
</section>

<section class="w-full xl:w-3/5 p-8 bg-white rounded shadow">
  <!-- Header -->
  <div class="text-center md:text-left space-y-2 mb-8">
    <h1 class="text-xl font-medium text-gray-800">Manajemen Produk</h1>
    <p class="text-gray-500 text-sm">Menampilkan informasi kategori produk dan produk yang disewakan</p>
  </div>

  <div class="mb-6 border-b border-gray-200">
    <nav class="flex pb-4" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
        <li class="inline-flex items-center">
          <a class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
            Kategori Produk
          </a>
        </li>
        <li>
          <div class="flex items-center">
            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
              fill="none" viewBox="0 0 6 10">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="m1 9 4-4-4-4" />
            </svg>
            <a href="{{ url_for('products') }}"
              class="ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2">Produk</a>
          </div>
        </li>
      </ol>
    </nav>
  </div>

  <!--
  <div class="mb-4 flex justify-end space-x-2">
    <a href="{{ url_for('add_category') }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md 
          text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
          focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 no-print">
      <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      Add Category
    </a>
  </div>
-->
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead>
        <tr class="bg-gray-50">
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for category in categories %}
        <tr class="odd:bg-white even:bg-gray-50 hover:bg-gray-100 text-sm">
          <td class="px-6 py-3 whitespace-nowrap text-gray-900">{{ category.category_id }}</td>
          <td class="px-6 py-3 whitespace-nowrap text-gray-900">{{ category.name }}</td>
          <td class="px-6 py-3 whitespace-nowrap text-gray-900">{{ category.description }}</td>
          <td>
            <a href="{{ url_for('edit_category', category_id=category.category_id) }}">Edit</a>
            |
            <a href="#" class="delete-category" data-url="{{ url_for('delete_category', category_id=category.category_id) }}">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Back Button -->
  <a href="{{ url_for('dashboard') }}" class="group flex items-center text-indigo-600 font-medium w-fit pt-8">
    <i class="ph ph-arrow-left text-lg mr-2"></i>
    <span class="border-b border-transparent group-hover:border-indigo-600 transition-colors">Back to Dashboard</span>
  </a>
</section>

<!-- Notifikasi tambah category -->
<script>
  // Mixin untuk toast notifikasi
  const Toast = Swal.mixin({
    toast: true,
    position: "top-end",
    showConfirmButton: false,
    timer: 3000,
    timerProgressBar: true,
    didOpen: (toast) => {
      toast.onmouseenter = Swal.stopTimer;
      toast.onmouseleave = Swal.resumeTimer;
    }
  });

  // Mixin untuk dialog penting
  const QuickAlert = Swal.mixin({
    confirmButtonColor: '#4F46E5',
    background: '#fff',
    confirmButtonText: 'Oke!',
    customClass: {
      title: 'text-lg font-medium'
    }
  });

  const addUserForm = document.querySelector('#addCategoryForm');
  if (addCategoryForm) {
    addCategoryForm.addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      fetch('/add_category', {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            Toast.fire({
              icon: 'success',
              title: data.message
            }).then(() => {
              location.reload(); // Optional: Reload untuk reset form
            });
          } else {
            Toast.fire({
              icon: 'error',
              title: data.message || 'Gagal menambahkan kategori'
            });
          }
        })
        .catch(error => {
          console.error('Error:', error);
          Toast.fire({
            icon: 'error',
            title: 'Terjadi kesalahan pada server'
          });
        });
    });
  }
</script>

<!--Notifikasi Delete-->
<script>
  document.querySelectorAll('.delete-category').forEach(el => {
    el.addEventListener('click', function (e) {
      e.preventDefault(); // cegah navigasi default

      const url = this.getAttribute('data-url');

      Swal.fire({
        title: 'Yakin ingin menghapus kategori ini?',
        text: "Data yang dihapus tidak bisa dikembalikan!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ya, hapus!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          fetch(url, {
            method: 'POST',
            headers: {
              'X-Requested-With': 'XMLHttpRequest',
              'Content-Type': 'application/x-www-form-urlencoded',
              // Jika menggunakan CSRF, tambahkan token header di sini
            },
            body: '' // kosong karena tidak ada form data
          })
            .then(response => response.json())
            .then(data => {
              if (data.status === 'success') {
                Toast.fire({
                  icon: 'success',
                  title: data.message || 'Kategori berhasil dihapus'
                }).then(() => location.reload());
              } else {
                Toast.fire({
                  icon: 'error',
                  title: data.message || 'Gagal menghapus kategori'
                });
              }
            })
            .catch(() => {
              Toast.fire({
                icon: 'error',
                title: 'Terjadi kesalahan server'
              });
            });
        }
      });
    });
  });
</script>
{% endblock %}